<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Jumper Junior</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body { margin: 0; overflow: hidden; background-color: #87CEEB; touch-action: none; font-family: 'Fredoka One', cursive; }
        canvas { display: block; margin: 0 auto; background: linear-gradient(#87CEEB, #E0F7FA); }
        #ui-layer { position: absolute; top: 10px; left: 10px; color: #333; pointer-events: none; width: calc(100% - 20px); z-index: 10; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border: 8px solid #FFD700; border-radius: 30px; text-align: center; z-index: 100; width: 90%; max-width: 500px; max-height: 85vh; overflow-y: auto; box-shadow: 0px 10px 0px #DAA520; }
        .btn { background: #FF4757; color: white; border: none; padding: 15px 25px; font-size: 16px; cursor: pointer; margin: 8px; border-radius: 20px; border-bottom: 6px solid #B33939; font-family: 'Fredoka One', cursive; transition: transform 0.1s; }
        .btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .category-btn { background: #2ED573; border-bottom-color: #26AF5A; width: 100%; }
        #controls { position: fixed; bottom: 20px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 20px; pointer-events: none; }
        .touch-btn { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.6); border: 4px solid #333; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #333; pointer-events: auto; user-select: none; }
        .hidden { display: none !important; }
        .word-box { background: white; padding: 10px 20px; border-radius: 15px; border: 3px solid #333; display: inline-block; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="flex justify-between items-start">
            <div class="word-box">
                <div id="hint-display" class="text-sm text-blue-600 mb-1 hidden">HINT: <span id="hint-text">---</span></div>
                <div id="target-display" class="text-xl text-pink-500 mb-1">FIND: <span id="word-to-collect">---</span></div>
                <div class="text-2xl tracking-widest">
                    <span id="current-spelling" class="text-green-600"></span>
                </div>
            </div>
            <div id="lives-display" class="text-3xl"></div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="category-modal" class="modal">
        <h1 class="text-3xl mb-4 text-blue-500">KIDS WORD ADVENTURE</h1>
        <p class="mb-4 text-gray-600">Pick a fun topic!</p>
        <div id="category-list" class="grid grid-cols-1 gap-3"></div>
        <button class="btn bg-gray-400 border-gray-600 mt-4 text-xs" onclick="showImport()">Parent Settings</button>
    </div>

    <!-- Mode Selector -->
    <div id="mode-modal" class="modal hidden">
        <h1 class="text-2xl mb-4">HOW TO PLAY?</h1>
        <button class="btn bg-blue-500 border-blue-700 w-full mb-2" onclick="setMode('classic')">SEE THE WORD</button>
        <button class="btn bg-purple-500 border-purple-700 w-full mb-4" onclick="setMode('challenge')">GUESS FROM HINT</button>
        <button class="btn bg-gray-400 border-gray-600" onclick="backToCategories()">GO BACK</button>
    </div>

    <!-- Win Modal -->
    <div id="win-modal" class="modal hidden">
        <h1 class="text-4xl mb-4 text-green-500">AWESOME! ðŸŒŸ</h1>
        <p id="win-message" class="mb-6 text-xl"></p>
        <button class="btn bg-yellow-400 border-yellow-600 text-black" onclick="speakWord()">ðŸ”Š HEAR WORD</button>
        <button class="btn bg-green-500 border-green-700" onclick="nextWord()">PLAY NEXT</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div class="flex gap-6">
            <div class="touch-btn" id="leftBtn">â—€</div>
            <div class="touch-btn" id="rightBtn">â–¶</div>
        </div>
        <div class="touch-btn" id="jumpBtn">â–²</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const categories = {
            "Junior (Age 4-6)": [
                {w: "CAT", h: "Meow! It likes milk"}, {w: "DOG", h: "Woof! A best friend"},
                {w: "SUN", h: "Big yellow light in sky"}, {w: "RED", h: "Color of an apple"},
                {w: "MOM", h: "A lady who loves you"}, {w: "DAD", h: "A man who loves you"},
                {w: "TOY", h: "Something you play with"}, {w: "ICE", h: "Very cold water"}
            ],
            "Animals": [
                {w: "LION", h: "King of the jungle"}, {w: "FISH", h: "Lives in water"},
                {w: "BIRD", h: "Flies in the sky"}, {w: "FROG", h: "Green and jumps"},
                {w: "DUCK", h: "Says Quack Quack"}, {w: "PIG", h: "Pink and says Oink"}
            ],
            "Colors": [
                {w: "BLUE", h: "Color of the sky"}, {w: "PINK", h: "Color of a flower"},
                {w: "GREEN", h: "Color of grass"}, {w: "WHITE", h: "Color of milk"}
            ]
        };

        const config = { gravity: 0.4, jumpStrength: -11, speed: 5, groundHeight: 80, maxLives: 3 };
        let activeWords = [], currentWordIndex = 0, currentObj = {}, targetWord = '', collectedLetters = '', lives = 3, gameRunning = false, gameMode = 'classic';
        const player = { x: 50, y: 0, width: 45, height: 45, velX: 0, velY: 0, grounded: false };
        let platforms = [], letters = [], clouds = [], keys = {};

        function initCategories() {
            const list = document.getElementById('category-list');
            list.innerHTML = '';
            Object.keys(categories).forEach(cat => {
                const b = document.createElement('button');
                b.className = 'btn category-btn';
                b.innerText = cat;
                b.onclick = () => {
                    activeWords = [...categories[cat]].sort(() => Math.random() - 0.5);
                    document.getElementById('category-modal').classList.add('hidden');
                    document.getElementById('mode-modal').classList.remove('hidden');
                };
                list.appendChild(b);
            });
        }

        function setMode(mode) {
            gameMode = mode;
            document.getElementById('mode-modal').classList.add('hidden');
            currentWordIndex = 0;
            prepareWord();
        }

        function backToCategories() {
            document.getElementById('mode-modal').classList.add('hidden');
            document.getElementById('category-modal').classList.remove('hidden');
        }

        function prepareWord() {
            currentObj = activeWords[currentWordIndex];
            targetWord = currentObj.w.toUpperCase();
            collectedLetters = '';
            
            if (gameMode === 'classic') {
                document.getElementById('hint-display').classList.add('hidden');
                document.getElementById('target-display').classList.remove('hidden');
                document.getElementById('word-to-collect').innerText = targetWord;
            } else {
                document.getElementById('hint-display').classList.remove('hidden');
                document.getElementById('target-display').classList.add('hidden');
                document.getElementById('hint-text').innerText = currentObj.h;
            }

            document.getElementById('current-spelling').innerText = '_ '.repeat(targetWord.length);
            setupLevel();
            gameRunning = true;
            lives = 3;
            updateLivesUI();
            requestAnimationFrame(gameLoop);
        }

        function setupLevel() {
            const groundY = canvas.height - config.groundHeight;
            player.x = 50; player.y = groundY - player.height;
            player.velX = 0; player.velY = 0;
            
            // Simpler Platforming for Kids: Wider and closer
            platforms = [{ x: 0, y: groundY, w: canvas.width, h: config.groundHeight }];
            for(let i=0; i < 8; i++) {
                platforms.push({ 
                    x: 50 + (i * (canvas.width / 9)), 
                    y: groundY - (60 + Math.random() * 100), 
                    w: 120, 
                    h: 25 
                });
            }
            
            letters = [];
            const chars = targetWord.split('');
            // Fewer distractors for younger kids
            const distractors = "ABC".split('').sort(() => 0.5 - Math.random()).slice(0, 1);
            
            [...chars, ...distractors].forEach((char) => {
                const p = platforms[Math.floor(Math.random() * (platforms.length - 1)) + 1];
                letters.push({ 
                    char, 
                    x: p.x + (Math.random() * (p.w - 40)), 
                    y: p.y - 55, 
                    width: 45, height: 45, 
                    collected: false, 
                    floating: Math.random() * 10 
                });
            });
            
            clouds = [];
            for(let i=0; i<5; i++) clouds.push({ x: Math.random()*canvas.width, y: Math.random()*150, s: 1+Math.random(), v: 0.1+Math.random()*0.3 });
        }

        function speakWord() {
            const utterance = new SpeechSynthesisUtterance(targetWord);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }

        function updateLivesUI() {
            document.getElementById('lives-display').innerHTML = 'â­'.repeat(lives);
        }

        function nextWord() {
            document.getElementById('win-modal').classList.add('hidden');
            currentWordIndex = (currentWordIndex + 1) % activeWords.length;
            prepareWord();
        }

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        const setupTouch = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        };
        setupTouch('leftBtn', 'ArrowLeft');
        setupTouch('rightBtn', 'ArrowRight');
        setupTouch('jumpBtn', 'Space');

        function gameLoop() {
            if (!gameRunning) return;
            if (keys['ArrowLeft']) player.velX = -config.speed;
            else if (keys['ArrowRight']) player.velX = config.speed;
            else player.velX *= 0.8;
            
            if ((keys['ArrowUp'] || keys['Space']) && player.grounded) { 
                player.velY = config.jumpStrength; 
                player.grounded = false; 
            }
            player.velY += config.gravity;
            player.x += player.velX; player.y += player.velY;

            player.grounded = false;
            platforms.forEach(p => {
                if (player.x + player.width > p.x && player.x < p.x + p.w && player.velY >= 0 && player.y + player.height <= p.y + player.velY + 10 && player.y + player.height >= p.y - 10) {
                    player.y = p.y - player.height; player.velY = 0; player.grounded = true;
                }
            });

            if (player.x < 0) player.x = 0; 
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            if (player.y > canvas.height) { player.x = 50; player.y = 0; lives--; updateLivesUI(); if(lives==0) location.reload(); }

            letters.forEach(l => {
                if (!l.collected && player.x < l.x + l.width && player.x + player.width > l.x && player.y < l.y + l.height && player.y + player.height > l.y) {
                    if (l.char === targetWord[collectedLetters.length]) {
                        l.collected = true; collectedLetters += l.char;
                        document.getElementById('current-spelling').innerText = collectedLetters + '_ '.repeat(targetWord.length - collectedLetters.length);
                        if (collectedLetters === targetWord) {
                            gameRunning = false; 
                            document.getElementById('win-message').innerText = `YOU SPELLED ${targetWord}!`; 
                            document.getElementById('win-modal').classList.remove('hidden');
                        }
                    } else { 
                        // Visual feedback only for kids, no death on wrong letter pick
                        l.shaking = 10;
                    }
                }
            });
            draw();
            requestAnimationFrame(gameLoop);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw Ground and Sky
            ctx.fillStyle = "#4CAF50"; ctx.fillRect(0, canvas.height - config.groundHeight, canvas.width, config.groundHeight);
            
            clouds.forEach(c => {
                ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(c.x, c.y, 20*c.s, 0, Math.PI*2); ctx.arc(c.x+20, c.y-10, 25*c.s, 0, Math.PI*2); ctx.arc(c.x+40, c.y, 20*c.s, 0, Math.PI*2); ctx.fill();
                c.x += c.v; if (c.x > canvas.width + 100) c.x = -100;
            });

            platforms.forEach((p, i) => {
                if(i === 0) return;
                ctx.fillStyle = "#FF7F50"; ctx.beginPath(); ctx.roundRect(p.x, p.y, p.w, p.h, 10); ctx.fill();
            });

            letters.forEach(l => {
                if (!l.collected) {
                    const nextCharNeeded = targetWord[collectedLetters.length];
                    l.floating += 0.05; const b = Math.sin(l.floating) * 8;
                    let offsetX = 0; if(l.shaking > 0) { offsetX = Math.sin(l.shaking) * 5; l.shaking--; }
                    
                    // Highlight the next letter for the child
                    if (l.char === nextCharNeeded) {
                        ctx.strokeStyle = "white"; ctx.lineWidth = 4; ctx.setLineDash([5, 5]);
                        ctx.strokeRect(l.x-5+offsetX, l.y-5+b, l.width+10, l.height+10);
                        ctx.setLineDash([]);
                    }

                    ctx.fillStyle = l.char === nextCharNeeded ? '#FFF' : '#FFD700'; 
                    ctx.beginPath(); ctx.roundRect(l.x+offsetX, l.y+b, l.width, l.height, 10); ctx.fill();
                    ctx.fillStyle = '#333'; ctx.font = '24px Fredoka One'; ctx.textAlign = 'center'; 
                    ctx.fillText(l.char, l.x + 22 + offsetX, l.y + 32 + b);
                }
            });

            // Player - Big Friendly Emoji
            ctx.font = '40px Arial'; ctx.textAlign = 'center';
            ctx.fillText('ðŸ˜Š', player.x + 22, player.y + 35);
        }

        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        window.onresize(); initCategories();
    </script>
</body>
</html>
